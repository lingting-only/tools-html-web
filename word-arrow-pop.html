<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•è¯å°„ç®­çˆ†ç ´ (Word Arrow Pop)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to bottom, #87CEEB, #98FB98);
            overflow: hidden;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #game-container {
            position: relative;
            width: 50vw;
            height: 100vh;
            max-height: 100vh;
            min-height: 500px;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 70%);
            overflow: hidden;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }

        /* å¼€å§‹ç•Œé¢ */
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: white;
            padding: 20px;
            box-sizing: border-box;
        }

        .start-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
            width: 100%;
            max-width: 600px;
            text-align: center;
        }

        .start-content h1 {
            font-size: clamp(2em, 8vw, 3.5em);
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
            margin: 0;
        }

        .start-content p {
            font-size: clamp(1em, 3vw, 1.4em);
            opacity: 0.9;
            margin: 0;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .upload-download-buttons {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .file-input-label,
            .template-button {
                padding: 10px 20px;
                font-size: 0.9em;
                width: 100%;
                max-width: 250px;
            }

            .template-guide {
                padding: 15px;
                font-size: 0.85em;
            }

            .button {
                padding: 12px 24px;
                font-size: 1em;
            }
        }

        .button {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* æ–‡ä»¶ä¸Šä¼  */
        #file-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 100%;
        }

        .upload-download-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .file-input-container {
            position: relative;
            display: inline-block;
        }

        #file-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 10;
        }

        .file-input-label {
            display: inline-block;
            background: linear-gradient(45deg, #4ECDC4, #45B7D1);
            border: none;
            color: white;
            padding: 12px 24px;
            font-size: 1em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            white-space: nowrap;
        }

        .file-input-label:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .file-input-label::before {
            content: 'ğŸ“ ';
            margin-right: 8px;
        }

        .file-info {
            font-size: 0.9em;
            color: #ddd;
            text-align: center;
        }

        .template-button {
            background: linear-gradient(45deg, #FFD166, #06D6A0);
            border: none;
            color: white;
            padding: 12px 24px;
            font-size: 1em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .template-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .template-button::before {
            content: 'ğŸ“¥ ';
            margin-right: 8px;
        }

        .template-guide {
            padding: 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            max-width: 100%;
            text-align: left;
            font-size: 0.9em;
            line-height: 1.5;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .template-guide h3 {
            margin-bottom: 10px;
            color: #4ECDC4;
        }

        .template-guide ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        .template-guide li {
            margin-bottom: 5px;
        }

        /* æ¸¸æˆç•Œé¢å…ƒç´  */
        #game-ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 1.2em;
            z-index: 50;
        }

        #score {
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        #timer-container {
            width: 200px;
            height: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        #timer-bar {
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, #FF6B6B, #4ECDC4);
            transition: width 1s linear;
        }

        /* è®¾ç½®æŒ‰é’® */
        .settings-button {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .settings-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        /* å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
            color: white;
        }

        .modal-content h2 {
            margin-bottom: 30px;
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .modal-button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            font-size: 1em;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .modal-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .close-button {
            background: rgba(255, 255, 255, 0.1) !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
        }

        /* ç»“æŸç•Œé¢ */
        #end-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: white;
        }

        #end-screen h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        #final-score,
        #high-score {
            font-size: 1.5em;
            margin: 10px 0;
        }

        /* äº‘æœµèƒŒæ™¯ */
        .cloud {
            position: absolute;
            background: white;
            border-radius: 50px;
            opacity: 0.8;
            animation: float 20s infinite linear;
        }

        .cloud::before,
        .cloud::after {
            content: '';
            position: absolute;
            background: white;
            border-radius: 50%;
        }

        .cloud:nth-child(1) {
            width: 100px;
            height: 60px;
            top: 10%;
            left: -100px;
            animation-duration: 30s;
        }

        .cloud:nth-child(2) {
            width: 150px;
            height: 80px;
            top: 20%;
            left: -150px;
            animation-duration: 40s;
            animation-delay: 10s;
        }

        .cloud:nth-child(3) {
            width: 80px;
            height: 50px;
            top: 30%;
            left: -80px;
            animation-duration: 25s;
            animation-delay: 5s;
        }

        @keyframes float {
            from {
                transform: translateX(0);
            }

            to {
                transform: translateX(900px);
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 800px) {
            #game-container {
                width: 100vw;
                height: 100vh;
            }

            #start-screen h1 {
                font-size: 2em;
            }

            #start-screen p {
                font-size: 1em;
            }
        }
    </style>
</head>

<body>
    <!-- SheetJSåº“ç”¨äºè§£æExcelæ–‡ä»¶ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <div id="game-container">
        <!-- æ¸¸æˆç”»å¸ƒ -->
        <canvas id="gameCanvas" width="800" height="600"></canvas>

        <!-- æ¸¸æˆUI -->
        <div id="game-ui">
            <div id="score">åˆ†æ•°: 0</div>
            <div id="timer-container">
                <div id="timer-bar"></div>
            </div>
            <div id="time">æ—¶é—´: 60s</div>
            <div id="settings-btn" class="settings-button">âš™ï¸</div>
        </div>

        <!-- è®¾ç½®å¼¹çª— -->
        <div id="settings-modal" class="modal">
            <div class="modal-content">
                <h2>æ¸¸æˆè®¾ç½®</h2>
                <button id="return-home-btn" class="modal-button">è¿”å›é¦–é¡µ</button>
                <button id="restart-game-btn" class="modal-button">é‡æ–°å¼€å§‹</button>
                <button id="close-settings-btn" class="modal-button close-button">å…³é—­</button>
            </div>
        </div>

        <!-- å¼€å§‹ç•Œé¢ -->
        <div id="start-screen">
            <div class="start-content">
                <h1>å•è¯å°„ç®­çˆ†ç ´</h1>
                <p>Word Arrow Pop</p>

                <div id="file-upload">
                    <div class="upload-download-buttons">
                        <div class="file-input-container">
                            <input type="file" id="file-input" accept=".xls,.xlsx">
                            <label for="file-input" class="file-input-label">ä¸Šä¼ è‡ªå®šä¹‰è¯åº“</label>
                        </div>
                        <div class="download-template">
                            <button id="download-template-btn" class="template-button">ä¸‹è½½è¯åº“æ¨¡æ¿</button>
                        </div>
                    </div>
                    <div class="file-info">æ”¯æŒ xlsã€xlsx æ ¼å¼çš„è¯åº“æ–‡ä»¶</div>

                    <div class="template-guide">
                        <h3>æ¨¡æ¿ä½¿ç”¨è¯´æ˜ï¼š</h3>
                        <ol>
                            <li>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ä¸‹è½½è¯åº“æ¨¡æ¿æ–‡ä»¶</li>
                            <li>æ‰“å¼€ä¸‹è½½çš„ Excel æ–‡ä»¶</li>
                            <li>æŒ‰ç…§æ¨¡æ¿æ ¼å¼å¡«å†™å•è¯æ•°æ®ï¼š
                                <ul>
                                    <li>ç¬¬ä¸€åˆ—ï¼šè‹±æ–‡å•è¯ï¼ˆå¿…å¡«ï¼‰</li>
                                    <li>ç¬¬äºŒåˆ—ï¼šä¸­æ–‡ç¿»è¯‘ï¼ˆå¿…å¡«ï¼‰</li>
                                    <li>ç¬¬ä¸‰åˆ—ï¼šéŸ³æ ‡ï¼ˆå¯é€‰ï¼‰</li>
                                </ul>
                            </li>
                            <li>ä¿å­˜æ–‡ä»¶åï¼Œç‚¹å‡»"ä¸Šä¼ è‡ªå®šä¹‰è¯åº“"æŒ‰é’®é€‰æ‹©è¯¥æ–‡ä»¶</li>
                            <li>ä¸Šä¼ æˆåŠŸåç‚¹å‡»"å¼€å§‹æ¸¸æˆ"å³å¯ä½¿ç”¨è‡ªå®šä¹‰è¯åº“</li>
                        </ol>
                    </div>
                </div>

                <button id="start-btn" class="button">å¼€å§‹æ¸¸æˆ</button>
            </div>
        </div>

        <!-- ç»“æŸç•Œé¢ -->
        <div id="end-screen">
            <h2>æ¸¸æˆç»“æŸ!</h2>
            <div id="final-score">æœ€ç»ˆåˆ†æ•°: 0</div>
            <div id="accuracy">æ­£ç­”ç‡: 0%</div>
            <div id="high-score">æœ€é«˜åˆ†: 0</div>
            <button id="restart-btn" class="button">é‡ç©</button>
        </div>
    </div>

    <script>
        // é»˜è®¤è¯åº“ - 100ä¸ªé›…æ€é«˜é¢‘è¯ï¼ˆå¸¦éŸ³æ ‡ï¼‰
        const defaultWordList = [
            { en: 'apple', zh: 'è‹¹æœ', phonetic: '/ËˆÃ¦pl/' },
            { en: 'banana', zh: 'é¦™è•‰', phonetic: '/bÉ™ËˆnÉ‘ËnÉ™/' },
            { en: 'cat', zh: 'çŒ«', phonetic: '/kÃ¦t/' },
            { en: 'dog', zh: 'ç‹—', phonetic: '/dÉ”ËÉ¡/' },
            { en: 'elephant', zh: 'å¤§è±¡', phonetic: '/ËˆelÉªfÉ™nt/' },
            { en: 'fish', zh: 'é±¼', phonetic: '/fÉªÊƒ/' },
            { en: 'goat', zh: 'å±±ç¾Š', phonetic: '/É¡É™ÊŠt/' },
            { en: 'horse', zh: 'é©¬', phonetic: '/hÉ”Ës/' },
            { en: 'ice', zh: 'å†°', phonetic: '/aÉªs/' },
            { en: 'juice', zh: 'æœæ±', phonetic: '/dÊ’uËs/' },
            { en: 'kite', zh: 'é£ç­', phonetic: '/kaÉªt/' },
            { en: 'lion', zh: 'ç‹®å­', phonetic: '/ËˆlaÉªÉ™n/' },
            { en: 'monkey', zh: 'çŒ´å­', phonetic: '/ËˆmÊŒÅ‹ki/' },
            { en: 'notebook', zh: 'ç¬”è®°æœ¬', phonetic: '/ËˆnÉ™ÊŠtbÊŠk/' },
            { en: 'orange', zh: 'æ©™å­', phonetic: '/ËˆÉ’rÉªndÊ’/' },
            { en: 'pen', zh: 'é’¢ç¬”', phonetic: '/pen/' },
            { en: 'queen', zh: 'å¥³ç‹', phonetic: '/kwiËn/' },
            { en: 'rabbit', zh: 'å…”å­', phonetic: '/ËˆrÃ¦bÉªt/' },
            { en: 'sun', zh: 'å¤ªé˜³', phonetic: '/sÊŒn/' },
            { en: 'tree', zh: 'æ ‘', phonetic: '/triË/' },
            { en: 'umbrella', zh: 'é›¨ä¼', phonetic: '/ÊŒmËˆbrelÉ™/' },
            { en: 'violin', zh: 'å°æç´', phonetic: '/ËŒvaÉªÉ™ËˆlÉªn/' },
            { en: 'water', zh: 'æ°´', phonetic: '/ËˆwÉ”ËtÉ™/' },
            { en: 'xylophone', zh: 'æœ¨ç´', phonetic: '/ËˆzaÉªlÉ™fÉ™ÊŠn/' },
            { en: 'yacht', zh: 'æ¸¸è‰‡', phonetic: '/jÉ’t/' },
            { en: 'zebra', zh: 'æ–‘é©¬', phonetic: '/ËˆzebrÉ™/' },
            { en: 'airplane', zh: 'é£æœº', phonetic: '/ËˆeÉ™pleÉªn/' },
            { en: 'ball', zh: 'çƒ', phonetic: '/bÉ”Ël/' },
            { en: 'car', zh: 'æ±½è½¦', phonetic: '/kÉ‘Ë/' },
            { en: 'door', zh: 'é—¨', phonetic: '/dÉ”Ë/' },
            { en: 'egg', zh: 'é¸¡è›‹', phonetic: '/eÉ¡/' },
            { en: 'flower', zh: 'èŠ±', phonetic: '/ËˆflaÊŠÉ™/' },
            { en: 'guitar', zh: 'å‰ä»–', phonetic: '/É¡ÉªËˆtÉ‘Ë/' },
            { en: 'house', zh: 'æˆ¿å­', phonetic: '/haÊŠs/' },
            { en: 'island', zh: 'å²›å±¿', phonetic: '/ËˆaÉªlÉ™nd/' },
            { en: 'jacket', zh: 'å¤¹å…‹', phonetic: '/ËˆdÊ’Ã¦kÉªt/' },
            { en: 'kangaroo', zh: 'è¢‹é¼ ', phonetic: '/ËŒkÃ¦Å‹É¡É™ËˆruË/' },
            { en: 'lamp', zh: 'ç¯', phonetic: '/lÃ¦mp/' },
            { en: 'mountain', zh: 'å±±', phonetic: '/ËˆmaÊŠntÉ™n/' },
            { en: 'nest', zh: 'é¸Ÿå·¢', phonetic: '/nest/' },
            { en: 'ocean', zh: 'æµ·æ´‹', phonetic: '/ËˆÉ™ÊŠÊƒn/' },
            { en: 'piano', zh: 'é’¢ç´', phonetic: '/piËˆÃ¦nÉ™ÊŠ/' },
            { en: 'queen', zh: 'å¥³ç‹', phonetic: '/kwiËn/' },
            { en: 'river', zh: 'æ²³æµ', phonetic: '/ËˆrÉªvÉ™/' },
            { en: 'star', zh: 'æ˜Ÿæ˜Ÿ', phonetic: '/stÉ‘Ë/' },
            { en: 'table', zh: 'æ¡Œå­', phonetic: '/ËˆteÉªbl/' },
            { en: 'umbrella', zh: 'é›¨ä¼', phonetic: '/ÊŒmËˆbrelÉ™/' },
            { en: 'volcano', zh: 'ç«å±±', phonetic: '/vÉ’lËˆkeÉªnÉ™ÊŠ/' },
            { en: 'window', zh: 'çª—æˆ·', phonetic: '/ËˆwÉªndÉ™ÊŠ/' },
            { en: 'x-ray', zh: 'Xå…‰', phonetic: '/Ëˆeks reÉª/' },
            { en: 'yak', zh: 'ç‰¦ç‰›', phonetic: '/jÃ¦k/' },
            { en: 'zoo', zh: 'åŠ¨ç‰©å›­', phonetic: '/zuË/' },
            { en: 'book', zh: 'ä¹¦', phonetic: '/bÊŠk/' },
            { en: 'chair', zh: 'æ¤…å­', phonetic: '/tÊƒeÉ™/' },
            { en: 'desk', zh: 'ä¹¦æ¡Œ', phonetic: '/desk/' },
            { en: 'eraser', zh: 'æ©¡çš®æ“¦', phonetic: '/ÉªËˆreÉªzÉ™/' },
            { en: 'folder', zh: 'æ–‡ä»¶å¤¹', phonetic: '/ËˆfÉ™ÊŠldÉ™/' },
            { en: 'glue', zh: 'èƒ¶æ°´', phonetic: '/É¡luË/' },
            { en: 'highlighter', zh: 'è§å…‰ç¬”', phonetic: '/ËˆhaÉªlaÉªtÉ™/' },
            { en: 'ink', zh: 'å¢¨æ°´', phonetic: '/ÉªÅ‹k/' },
            { en: 'jar', zh: 'ç½å­', phonetic: '/dÊ’É‘Ë/' },
            { en: 'key', zh: 'é’¥åŒ™', phonetic: '/kiË/' },
            { en: 'laptop', zh: 'ç¬”è®°æœ¬ç”µè„‘', phonetic: '/ËˆlÃ¦ptÉ’p/' },
            { en: 'mouse', zh: 'é¼ æ ‡', phonetic: '/maÊŠs/' },
            { en: 'notebook', zh: 'ç¬”è®°æœ¬', phonetic: '/ËˆnÉ™ÊŠtbÊŠk/' },
            { en: 'pencil', zh: 'é“…ç¬”', phonetic: '/Ëˆpensl/' },
            { en: 'ruler', zh: 'å°ºå­', phonetic: '/ËˆruËlÉ™/' },
            { en: 'scissors', zh: 'å‰ªåˆ€', phonetic: '/ËˆsÉªzÉ™z/' },
            { en: 'tape', zh: 'èƒ¶å¸¦', phonetic: '/teÉªp/' },
            { en: 'usb', zh: 'USB', phonetic: '/ËŒjuË es ËˆbiË/' },
            { en: 'ventilator', zh: 'é€šé£æœº', phonetic: '/ËˆventÉªleÉªtÉ™/' },
            { en: 'watch', zh: 'æ‰‹è¡¨', phonetic: '/wÉ’tÊƒ/' },
            { en: 'xylophone', zh: 'æœ¨ç´', phonetic: '/ËˆzaÉªlÉ™fÉ™ÊŠn/' },
            { en: 'yarn', zh: 'çº±çº¿', phonetic: '/jÉ‘Ën/' },
            { en: 'zip', zh: 'æ‹‰é“¾', phonetic: '/zÉªp/' },
            { en: 'ant', zh: 'èš‚èš', phonetic: '/Ã¦nt/' },
            { en: 'bee', zh: 'èœœèœ‚', phonetic: '/biË/' },
            { en: 'cow', zh: 'å¥¶ç‰›', phonetic: '/kaÊŠ/' },
            { en: 'duck', zh: 'é¸­å­', phonetic: '/dÊŒk/' },
            { en: 'eagle', zh: 'é¹°', phonetic: '/ËˆiËÉ¡l/' },
            { en: 'frog', zh: 'é’è›™', phonetic: '/frÉ’É¡/' },
            { en: 'goose', zh: 'é¹…', phonetic: '/É¡uËs/' },
            { en: 'hamster', zh: 'ä»“é¼ ', phonetic: '/ËˆhÃ¦mstÉ™/' },
            { en: 'iguana', zh: 'é¬£èœ¥', phonetic: '/ÉªËˆÉ¡wÉ‘ËnÉ™/' },
            { en: 'jellyfish', zh: 'æ°´æ¯', phonetic: '/ËˆdÊ’eliËŒfÉªÊƒ/' },
            { en: 'koala', zh: 'è€ƒæ‹‰', phonetic: '/kÉ™ÊŠËˆÉ‘ËlÉ™/' },
            { en: 'ladybug', zh: 'ç“¢è™«', phonetic: '/ËˆleÉªdibÊŒÉ¡/' },
            { en: 'mouse', zh: 'è€é¼ ', phonetic: '/maÊŠs/' },
            { en: 'newt', zh: 'è¾èˆ', phonetic: '/njuËt/' },
            { en: 'octopus', zh: 'ç« é±¼', phonetic: '/ËˆÉ’ktÉ™pÉ™s/' },
            { en: 'penguin', zh: 'ä¼é¹…', phonetic: '/ËˆpeÅ‹É¡wÉªn/' },
            { en: 'quail', zh: 'é¹Œé¹‘', phonetic: '/kweÉªl/' },
            { en: 'robin', zh: 'çŸ¥æ›´é¸Ÿ', phonetic: '/ËˆrÉ’bÉªn/' },
            { en: 'snake', zh: 'è›‡', phonetic: '/sneÉªk/' },
            { en: 'tiger', zh: 'è€è™', phonetic: '/ËˆtaÉªÉ¡É™/' },
            { en: 'unicorn', zh: 'ç‹¬è§’å…½', phonetic: '/ËˆjuËnÉªkÉ”Ën/' },
            { en: 'vulture', zh: 'ç§ƒé¹«', phonetic: '/ËˆvÊŒltÊƒÉ™/' },
            { en: 'wolf', zh: 'ç‹¼', phonetic: '/wÊŠlf/' },
            { en: 'axolotl', zh: 'è¾èˆ', phonetic: '/ËŒÃ¦ksÉ™ËˆlÉ’tl/' },
            { en: 'baboon', zh: 'ç‹’ç‹’', phonetic: '/bÉ™ËˆbuËn/' },
            { en: 'cheetah', zh: 'çŒè±¹', phonetic: '/ËˆtÊƒiËtÉ™/' },
            { en: 'dolphin', zh: 'æµ·è±š', phonetic: '/ËˆdÉ’lfÉªn/' },
            { en: 'emu', zh: 'é¸¸é¹‹', phonetic: '/ËˆiËmjuË/' }
        ];

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            wordList: defaultWordList,
            currentWord: null,
            balloons: [],
            arrow: null,
            particles: [],
            score: 0,
            time: 120,
            isPlaying: false,
            isShooting: false,
            mouseX: 0,
            mouseY: 0,
            highScore: localStorage.getItem('wordArrowPopHighScore') || 0,
            showWordDetail: false,
            wordDetail: null,
            wordDetailTimer: 0,
            wordDetailDuration: 2000, // æ˜¾ç¤ºæ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰
            correctAnswers: 0, // ç­”å¯¹æ•°é‡
            totalShots: 0 // æ€»å‘å°„æ•°é‡
        };

        // Canvas ç›¸å…³
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let canvasWidth = 400;
        let canvasHeight = 300;
        let bow;

        // é¢œè‰²å¸¸é‡
        const balloonColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8'];

        // ç²’å­ç±» - å¢å¼ºçˆ†ç‚¸æ•ˆæœ
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 15; // æ›´å¤§çš„åˆå§‹é€Ÿåº¦
                this.vy = (Math.random() - 0.5) * 15 - 10; // æ›´å¤§çš„åˆå§‹é€Ÿåº¦å’Œå‘ä¸Šçš„åŠ›
                this.color = color;
                this.size = Math.random() * 8 + 4; // æ›´å¤§çš„ç²’å­å¤§å°
                this.alpha = 1;
                this.decay = 0.03; // æ›´å¿«çš„è¡°å‡
                this.gravity = 0.3; // æ›´å¼ºçš„é‡åŠ›
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += this.gravity; // åº”ç”¨é‡åŠ›
                this.alpha -= this.decay;
                // æ·»åŠ ç©ºæ°”é˜»åŠ›
                this.vx *= 0.98;
                this.vy *= 0.98;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;

                // ç»˜åˆ¶æ¸å˜ç²’å­ï¼Œå¢å¼ºè§†è§‰æ•ˆæœ
                const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size);
                gradient.addColorStop(0, this.color.replace(')', ', 1)').replace('rgb', 'rgba'));
                gradient.addColorStop(1, this.color.replace(')', ', 0)').replace('rgb', 'rgba'));

                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }

            isDead() {
                return this.alpha <= 0;
            }
        }

        // æ°”çƒç±»
        class Balloon {
            constructor(x, y, color, text, isCorrect) {
                this.x = x;
                this.y = y;
                this.originalY = y;
                this.color = color;
                this.text = text;
                this.isCorrect = isCorrect;
                this.radius = 30;
                this.floatingOffset = 0;
                this.floatingSpeed = 0.02 + Math.random() * 0.02;
                this.isPopping = false;
                this.popTimer = 0;
            }

            update() {
                if (!this.isPopping) {
                    this.floatingOffset += this.floatingSpeed;
                    this.y = this.originalY + Math.sin(this.floatingOffset) * 10;
                }
            }

            draw() {
                // æ°”çƒç»³
                ctx.beginPath();
                ctx.moveTo(this.x, this.y + this.radius);
                ctx.lineTo(this.x, this.y + this.radius + 30);
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.stroke();

                // æ°”çƒé˜´å½±
                ctx.beginPath();
                ctx.arc(this.x + 5, this.y + 5, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
                ctx.fill();

                // æ°”çƒä¸»ä½“
                const gradient = ctx.createRadialGradient(this.x - 10, this.y - 10, 0, this.x, this.y, this.radius);
                gradient.addColorStop(0, this.color.replace(')', ', 1)').replace('rgb', 'rgba'));
                gradient.addColorStop(1, this.color.replace(')', ', 0.8)').replace('rgb', 'rgba'));

                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();

                // æ°”çƒé«˜å…‰
                ctx.beginPath();
                ctx.arc(this.x - 8, this.y - 8, 8, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.fill();

                // æ–‡å­—
                ctx.fillStyle = '#333';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.text, this.x, this.y);
            }

            pop() {
                this.isPopping = true;
                this.popTimer = 30;
            }

            reset() {
                this.isPopping = false;
                this.popTimer = 0;
            }
        }

        // ç®­ç±»
        class Arrow {
            constructor(x, y, word) {
                this.x = x;
                this.y = y;
                this.vx = 0;
                this.vy = 0;
                this.word = word;
                this.length = 80;
                this.width = 4;
                this.isFlying = false;
                this.angle = 0; // åˆå§‹è§’åº¦ä¸º0ï¼ŒæŒ‡å‘æ­£å³æ–¹
            }

            shoot(targetX, targetY) {
                this.isFlying = true;
                const dx = targetX - this.x;
                const dy = targetY - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const speed = 25; // å¢å¤§å¼“ç®­åŠ›åº¦

                this.vx = (dx / distance) * speed;
                this.vy = (dy / distance) * speed;
                this.angle = Math.atan2(dy, dx);
            }

            update(mouseX, mouseY) {
                if (this.isFlying) {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.vy += 0.3; // é‡åŠ›
                    this.angle = Math.atan2(this.vy, this.vx);
                } else {
                    // æœªå‘å°„æ—¶ï¼Œç®­éšé¼ æ ‡æ—‹è½¬
                    const dx = mouseX - this.x;
                    const dy = mouseY - this.y;
                    this.angle = Math.atan2(dy, dx);
                }
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle);

                // ç®­æ† - æ­åœ¨å¼“ä¸Šï¼Œä¸å‘å³å»¶ä¼¸
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(-this.length / 2, -this.width / 2, this.length, this.width);

                // ç®­å¤´
                ctx.beginPath();
                ctx.moveTo(this.length / 2, -this.width);
                ctx.lineTo(this.length / 2 + 15, 0);
                ctx.lineTo(this.length / 2, this.width);
                ctx.closePath();
                ctx.fillStyle = '#C0C0C0';
                ctx.fill();

                // ç®­å°¾ç¾½æ¯›
                ctx.beginPath();
                ctx.moveTo(-this.length / 2, -this.width);
                ctx.lineTo(-this.length / 2 - 10, -this.width * 3);
                ctx.lineTo(-this.length / 2, -this.width * 1.5);
                ctx.closePath();
                ctx.fillStyle = '#FF6B6B';
                ctx.fill();

                ctx.beginPath();
                ctx.moveTo(-this.length / 2, this.width);
                ctx.lineTo(-this.length / 2 - 10, this.width * 3);
                ctx.lineTo(-this.length / 2, this.width * 1.5);
                ctx.closePath();
                ctx.fillStyle = '#4ECDC4';
                ctx.fill();

                ctx.restore();
            }

            isOutOfBounds() {
                return this.x < 0 || this.x > canvasWidth || this.y > canvasHeight;
            }
        }

        // å¼“ç±»
        class Bow {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.angle = 0;
            }

            update(mouseX, mouseY) {
                // è®¡ç®—å¼“çš„è§’åº¦
                const dx = mouseX - this.x;
                const dy = mouseY - this.y;
                this.angle = Math.atan2(dy, dx);
            }

            draw() {
                // ç»˜åˆ¶å¼“ä¸Šæ–¹çš„è‹±æ–‡å•è¯
                ctx.save();
                ctx.fillStyle = '#333';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'bottom';
                // å‘ä¸Šç§»åŠ¨å•è¯ä½ç½®ï¼Œé¿å…é®æŒ¡å¼“ç®­
                ctx.fillText(gameState.currentWord?.en || '', this.x, this.y - 60);
                ctx.restore();

                // å¼“èº«
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle);

                // ç»˜åˆ¶å¼¯æ›²çš„å¼“èº«
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 8;
                ctx.beginPath();
                ctx.arc(0, 0, 50, Math.PI * 0.8, Math.PI * 1.2, false);
                ctx.stroke();

                ctx.restore();
            }
        }

        // bowå°†åœ¨startGameå‡½æ•°ä¸­åˆå§‹åŒ–

        // ç”Ÿæˆæ–°çš„å•è¯å’Œæ°”çƒ
        function generateNewRound() {
            // ç¡®ä¿æœ¬è½®æ¸¸æˆä¸­å•è¯ä¸é‡å¤å‡ºç°
            if (!gameState.usedWords) {
                gameState.usedWords = [];
            }

            // éšæœºé€‰æ‹©ä¸€ä¸ªæœªä½¿ç”¨çš„å•è¯
            let newWord;
            do {
                newWord = gameState.wordList[Math.floor(Math.random() * gameState.wordList.length)];
            } while (gameState.usedWords.includes(newWord.en) && gameState.wordList.length > gameState.usedWords.length);

            gameState.currentWord = newWord;
            gameState.usedWords.push(newWord.en);

            // ç”Ÿæˆå¹²æ‰°é¡¹
            const distractors = [];
            while (distractors.length < 4) {
                const randomWord = gameState.wordList[Math.floor(Math.random() * gameState.wordList.length)];
                if (randomWord.zh !== gameState.currentWord.zh && !distractors.includes(randomWord.zh)) {
                    distractors.push(randomWord.zh);
                }
            }

            // ç»„åˆæ‰€æœ‰é€‰é¡¹
            const allOptions = [...distractors, gameState.currentWord.zh];
            allOptions.sort(() => Math.random() - 0.5);

            // ç”Ÿæˆæ°”çƒ - åˆ†èµ›é“æ’å¸ƒ
            gameState.balloons = [];

            // è®¡ç®—èµ›é“å®½åº¦å’Œä½ç½®
            const trackWidth = canvasWidth / 6; // 6ä¸ªèµ›é“é—´éš”ï¼Œ5ä¸ªèµ›é“
            const trackPositions = [];

            for (let i = 1; i <= 5; i++) {
                trackPositions.push(trackWidth * i);
            }

            // éšæœºæ‰“ä¹±èµ›é“ä½ç½®ï¼Œè®©æ°”çƒåˆ†å¸ƒæ›´è‡ªç„¶
            trackPositions.sort(() => Math.random() - 0.5);

            // ç”Ÿæˆæ°”çƒï¼Œæ¯ä¸ªèµ›é“ä¸€ä¸ª
            for (let i = 0; i < 5; i++) {
                const x = trackPositions[i];
                const y = 80 + Math.random() * 150; // å‚ç›´æ–¹å‘éšæœºï¼Œä½†æœ‰èŒƒå›´é™åˆ¶
                const color = balloonColors[i];
                const text = allOptions[i];
                const isCorrect = text === gameState.currentWord.zh;

                gameState.balloons.push(new Balloon(x, y, color, text, isCorrect));
            }

            // åˆ›å»ºæ–°ç®­ï¼Œåˆå§‹è§’åº¦ä¸å¼“ç›¸åŒ
            gameState.arrow = new Arrow(bow.x, bow.y, gameState.currentWord.en);
            gameState.arrow.angle = bow.angle;
        }

        // éŸ³é¢‘ä¸Šä¸‹æ–‡ - ç”¨äºæ’­æ”¾éŸ³æ•ˆ
        let audioContext;

        // åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡
        function initAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }

        // æ’­æ”¾çˆ†ç‚¸éŸ³æ•ˆ
        function playExplosionSound() {
            if (!audioContext) initAudio();

            // åˆ›å»ºæŒ¯è¡å™¨
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            // è®¾ç½®éŸ³æ•ˆå‚æ•°
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.2);

            gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);

            // æ’­æ”¾éŸ³æ•ˆ
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        }

        // ç”¨ç¾å¼è‹±è¯­å‘éŸ³è¯»å‡ºå•è¯
        function speakWord(word) {
            if ('speechSynthesis' in window) {
                // å–æ¶ˆå½“å‰æ­£åœ¨æ’­æ”¾çš„è¯­éŸ³
                window.speechSynthesis.cancel();

                // åˆ›å»ºè¯­éŸ³åˆæˆå¯¹è±¡
                const utterance = new SpeechSynthesisUtterance(word);

                // è®¾ç½®ç¾å¼è‹±è¯­å‘éŸ³
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 1;

                // æ’­æ”¾è¯­éŸ³
                window.speechSynthesis.speak(utterance);
            }
        }

        // æ£€æµ‹ç¢°æ’
        function checkCollision(arrow, balloon) {
            const dx = arrow.x - balloon.x;
            const dy = arrow.y - balloon.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            return distance < balloon.radius;
        }

        // åˆ›å»ºçˆ†ç‚¸æ•ˆæœ
        function createExplosion(x, y, color) {
            // ç”Ÿæˆæ›´å¤šç²’å­ï¼Œå¢å¼ºçˆ†ç‚¸æ•ˆæœ
            for (let i = 0; i < 50; i++) {
                gameState.particles.push(new Particle(x, y, color));
            }
        }

        // ç»˜åˆ¶èƒŒæ™¯
        function drawBackground() {
            // å¤©ç©ºæ¸å˜
            const gradient = ctx.createLinearGradient(0, 0, 0, canvasHeight);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(0.7, '#98FB98');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
        }

        // ç»˜åˆ¶æ¸¸æˆ
        function draw() {
            drawBackground();

            // ç»˜åˆ¶æ°”çƒ
            gameState.balloons.forEach(balloon => {
                balloon.draw();
            });

            // ç»˜åˆ¶å¼“
            if (bow) {
                bow.draw();
            }

            // ç»˜åˆ¶ç®­
            if (gameState.arrow) {
                gameState.arrow.draw();
            }

            // ç»˜åˆ¶ç²’å­
            gameState.particles.forEach(particle => {
                particle.draw();
            });

            // ç»˜åˆ¶å•è¯è¯¦æƒ…
            if (gameState.showWordDetail && gameState.wordDetail) {
                const centerX = canvasWidth / 2;
                const centerY = canvasHeight / 2;

                ctx.save();

                // ç»˜åˆ¶è‹±æ–‡å•è¯å’ŒéŸ³æ ‡ï¼ˆæ— èƒŒæ™¯ï¼‰
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                // ç»˜åˆ¶è‹±æ–‡å•è¯
                ctx.fillStyle = '#333';
                ctx.font = 'bold 32px Arial';
                ctx.fillText(gameState.wordDetail.en, centerX, centerY - 20);

                // æµ‹é‡è‹±æ–‡å•è¯å®½åº¦ï¼Œç²¾ç¡®è®¡ç®—éŸ³æ ‡ä½ç½®
                const wordWidth = ctx.measureText(gameState.wordDetail.en).width;

                // ç»˜åˆ¶éŸ³æ ‡ï¼ˆç´§è·Ÿåœ¨è‹±æ–‡å•è¯åé¢ï¼‰
                ctx.fillStyle = '#666';
                ctx.font = '20px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(gameState.wordDetail.phonetic, centerX + wordWidth / 2 + 5, centerY - 20);

                // ç»˜åˆ¶ä¸­æ–‡ç¿»è¯‘
                ctx.fillStyle = '#4ECDC4';
                ctx.font = '24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(gameState.wordDetail.zh, centerX, centerY + 20);

                ctx.restore();
            }
        }

        // æ›´æ–°æ¸¸æˆ
        function update() {
            // æ›´æ–°å¼“çš„è§’åº¦
            bow.update(gameState.mouseX, gameState.mouseY);

            // æ›´æ–°æ°”çƒ
            gameState.balloons.forEach(balloon => {
                balloon.update();

                if (balloon.isPopping) {
                    balloon.popTimer--;
                    if (balloon.popTimer <= 0) {
                        balloon.reset();
                    }
                }
            });

            // æ›´æ–°ç®­
            if (gameState.arrow) {
                gameState.arrow.update(gameState.mouseX, gameState.mouseY);

                // æ£€æµ‹ç®­æ˜¯å¦é£å‡ºç”»å¸ƒ
                if (gameState.arrow.isOutOfBounds()) {
                    gameState.arrow = new Arrow(bow.x, bow.y, gameState.currentWord.en);
                    gameState.isShooting = false;
                }

                // æ£€æµ‹ç¢°æ’
                if (gameState.arrow.isFlying) {
                    for (let i = 0; i < gameState.balloons.length; i++) {
                        const balloon = gameState.balloons[i];
                        if (!balloon.isPopping && checkCollision(gameState.arrow, balloon)) {
                            // æ ‡è®°æ°”çƒä¸ºå·²çˆ†ç‚¸
                            balloon.isPopping = true;
                            balloon.popTimer = 30;
                            createExplosion(balloon.x, balloon.y, balloon.color);
                            playExplosionSound();

                            if (balloon.isCorrect) {
                                // æ­£ç¡®å‘½ä¸­
                                gameState.score++;
                                gameState.correctAnswers++;
                                speakWord(gameState.currentWord.en);

                                // æ˜¾ç¤ºå•è¯è¯¦æƒ…
                                gameState.showWordDetail = true;
                                gameState.wordDetail = {
                                    en: gameState.currentWord.en,
                                    zh: gameState.currentWord.zh,
                                    phonetic: gameState.currentWord.phonetic || ''
                                };
                                gameState.wordDetailTimer = Date.now();

                                // çŸ­æš‚å»¶è¿Ÿåç”Ÿæˆæ–°å›åˆ
                                setTimeout(() => {
                                    generateNewRound();
                                }, gameState.wordDetailDuration);
                            } else {
                                // é”™è¯¯å‘½ä¸­
                                gameState.score--;
                                balloon.pop();

                                // æ›¿æ¢ä¸ºæ–°çš„å¹²æ‰°é¡¹
                                let newText;
                                do {
                                    const randomWord = gameState.wordList[Math.floor(Math.random() * gameState.wordList.length)];
                                    newText = randomWord.zh;
                                } while (newText === gameState.currentWord.zh ||
                                    gameState.balloons.some(b => b.text === newText));

                                balloon.text = newText;
                            }

                            gameState.arrow = new Arrow(bow.x, bow.y, gameState.currentWord.en);
                            gameState.isShooting = false;
                            break;
                        }
                    }
                }
            }

            // æ›´æ–°ç²’å­
            gameState.particles = gameState.particles.filter(particle => {
                particle.update();
                return !particle.isDead();
            });

            // æ›´æ–°å•è¯è¯¦æƒ…æ˜¾ç¤º
            if (gameState.showWordDetail) {
                const elapsed = Date.now() - gameState.wordDetailTimer;
                if (elapsed > gameState.wordDetailDuration) {
                    gameState.showWordDetail = false;
                    gameState.wordDetail = null;
                }
            }
        }

        // æ¸¸æˆä¸»å¾ªç¯
        function gameLoop() {
            if (gameState.isPlaying) {
                update();
                draw();
                gameLoopId = requestAnimationFrame(gameLoop);
            }
        }

        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('score').textContent = `åˆ†æ•°: ${gameState.score}`;
            document.getElementById('time').textContent = `æ—¶é—´: ${gameState.time}s`;
            document.getElementById('timer-bar').style.width = `${(gameState.time / 60) * 100}%`;
        }

        // è®¡æ—¶å™¨
        function startTimer() {
            const timer = setInterval(() => {
                if (gameState.time > 0) {
                    gameState.time--;
                    updateUI();
                } else {
                    clearInterval(timer);
                    endGame();
                }
            }, 1000);
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            // è®¾ç½®ç”»å¸ƒå¤§å°ä¸ºå®¹å™¨å¤§å°
            const gameContainer = document.getElementById('game-container');
            canvasWidth = canvas.width = gameContainer.clientWidth;
            canvasHeight = canvas.height = gameContainer.clientHeight;

            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.score = 0;
            gameState.time = 120;
            gameState.isPlaying = true;
            gameState.isShooting = false;
            gameState.particles = [];
            gameState.correctAnswers = 0;
            gameState.totalShots = 0;
            gameState.usedWords = [];

            // åˆå§‹åŒ–å¼“
            bow = new Bow(canvasWidth / 2, canvasHeight - 80);

            // åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡
            initAudio();

            // ç”Ÿæˆç¬¬ä¸€è½®
            generateNewRound();

            // æ›´æ–°UI
            updateUI();

            // éšè—å¼€å§‹ç•Œé¢
            document.getElementById('start-screen').style.display = 'none';

            // å¼€å§‹è®¡æ—¶
            startTimer();

            // å¼€å§‹æ¸¸æˆå¾ªç¯
            gameLoop();
        }

        // ç»“æŸæ¸¸æˆ
        function endGame() {
            gameState.isPlaying = false;

            // æ›´æ–°æœ€é«˜åˆ†
            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
                localStorage.setItem('wordArrowPopHighScore', gameState.highScore);
            }

            // è®¡ç®—æ­£ç­”ç‡
            const accuracy = gameState.totalShots > 0 ?
                Math.round((gameState.correctAnswers / gameState.totalShots) * 100) : 0;

            // æ˜¾ç¤ºç»“æŸç•Œé¢
            const endScreen = document.getElementById('end-screen');
            document.getElementById('final-score').textContent = `æœ€ç»ˆåˆ†æ•°: ${gameState.score}`;
            document.getElementById('accuracy').textContent = `æ­£ç­”ç‡: ${accuracy}%`;
            document.getElementById('high-score').textContent = `æœ€é«˜åˆ†: ${gameState.highScore}`;
            endScreen.style.display = 'flex';
        }

        // å¤„ç†é¼ æ ‡ç§»åŠ¨
        function handleMouseMove(e) {
            const rect = canvas.getBoundingClientRect();
            gameState.mouseX = e.clientX - rect.left;
            gameState.mouseY = e.clientY - rect.top;
        }

        // å¤„ç†é¼ æ ‡ç‚¹å‡»
        function handleMouseClick(e) {
            if (!gameState.isPlaying || gameState.isShooting) return;

            gameState.isShooting = true;
            gameState.totalShots++;
            gameState.arrow.shoot(gameState.mouseX, gameState.mouseY);
        }

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            if (file.name.endsWith('.xls') || file.name.endsWith('.xlsx')) {
                // Excelæ–‡ä»¶å¤„ç†
                const reader = new FileReader();
                reader.onload = function (e) {
                    try {
                        // è§£æExcelæ–‡ä»¶
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });

                        // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];

                        // å°†å·¥ä½œè¡¨è½¬æ¢ä¸ºJSONæ ¼å¼
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                        // è½¬æ¢ä¸ºæ‰€éœ€æ ¼å¼ï¼š[{en: 'word', zh: 'ç¿»è¯‘', phonetic: 'éŸ³æ ‡'}, ...]
                        const wordList = jsonData.map(row => {
                            if (row.length >= 2) {
                                return {
                                    en: String(row[0]).trim(),
                                    zh: String(row[1]).trim(),
                                    phonetic: row.length >= 3 ? String(row[2]).trim() : ''
                                };
                            }
                            return null;
                        }).filter(item => item && item.en && item.zh);

                        if (wordList && wordList.length > 0) {
                            gameState.wordList = wordList;
                            alert(`æˆåŠŸå¯¼å…¥ ${wordList.length} ä¸ªå•è¯!`);
                        } else {
                            alert('Excelæ–‡ä»¶ä¸­æœªæ‰¾åˆ°æœ‰æ•ˆçš„å•è¯æ•°æ®!');
                        }
                    } catch (error) {
                        alert('Excelæ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶å†…å®¹!');
                    }
                };

                reader.readAsArrayBuffer(file);
            } else {
                // éExcelæ–‡ä»¶å¤„ç†ï¼ˆJSON/CSVï¼‰
                const reader = new FileReader();
                reader.onload = function (e) {
                    try {
                        let wordList;

                        if (file.name.endsWith('.json')) {
                            // JSONæ ¼å¼
                            wordList = JSON.parse(e.target.result);
                        } else if (file.name.endsWith('.csv')) {
                            // CSVæ ¼å¼
                            const lines = e.target.result.split('\n');
                            wordList = lines.map(line => {
                                const parts = line.split(',').map(item => item.trim());
                                return {
                                    en: parts[0] || '',
                                    zh: parts[1] || '',
                                    phonetic: parts[2] || ''
                                };
                            }).filter(item => item.en && item.zh);
                        }

                        if (wordList && wordList.length > 0) {
                            gameState.wordList = wordList;
                            alert(`æˆåŠŸå¯¼å…¥ ${wordList.length} ä¸ªå•è¯!`);
                        }
                    } catch (error) {
                        alert('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶å†…å®¹!');
                    }
                };

                reader.readAsText(file);
            }
        }

        // ä¸‹è½½è¯åº“æ¨¡æ¿
        function downloadTemplate() {
            // åˆ›å»ºæ¨¡æ¿æ•°æ®
            const templateData = [
                ['è‹±æ–‡å•è¯', 'ä¸­æ–‡ç¿»è¯‘', 'éŸ³æ ‡ï¼ˆå¯é€‰ï¼‰'],
                ['apple', 'è‹¹æœ', '/ËˆÃ¦pl/'],
                ['banana', 'é¦™è•‰', '/bÉ™ËˆnÉ‘ËnÉ™/'],
                ['cat', 'çŒ«', '/kÃ¦t/'],
                ['dog', 'ç‹—', '/dÉ”ËÉ¡/'],
                ['elephant', 'å¤§è±¡', '/ËˆelÉªfÉ™nt/']
            ];

            // åˆ›å»ºå·¥ä½œè¡¨
            const worksheet = XLSX.utils.aoa_to_sheet(templateData);

            // åˆ›å»ºå·¥ä½œç°¿
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'å•è¯è¡¨');

            // ç”ŸæˆExcelæ–‡ä»¶å¹¶ä¸‹è½½
            XLSX.writeFile(workbook, 'word_arrow_pop_template.xlsx');
        }

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            // é¼ æ ‡äº‹ä»¶
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('click', handleMouseClick);

            // è§¦æ‘¸äº‹ä»¶
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                handleMouseMove(touch);
            });

            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                handleMouseClick(touch);
            });

            // æŒ‰é’®äº‹ä»¶
            document.getElementById('start-btn').addEventListener('click', startGame);
            document.getElementById('restart-btn').addEventListener('click', () => {
                document.getElementById('end-screen').style.display = 'none';
                startGame();
            });

            // æ¨¡æ¿ä¸‹è½½äº‹ä»¶
            document.getElementById('download-template-btn').addEventListener('click', downloadTemplate);

            // æ–‡ä»¶ä¸Šä¼ äº‹ä»¶
            document.getElementById('file-input').addEventListener('change', handleFileUpload);

            // è®¾ç½®æŒ‰é’®äº‹ä»¶
            const settingsBtn = document.getElementById('settings-btn');
            if (settingsBtn) {
                settingsBtn.addEventListener('click', () => {
                    document.getElementById('settings-modal').style.display = 'flex';
                });
            }

            // è®¾ç½®å¼¹çª—äº‹ä»¶
            const settingsModal = document.getElementById('settings-modal');
            if (settingsModal) {
                // è¿”å›é¦–é¡µ
                const returnHomeBtn = document.getElementById('return-home-btn');
                if (returnHomeBtn) {
                    returnHomeBtn.addEventListener('click', () => {
                        // åœæ­¢æ¸¸æˆå¾ªç¯
                        if (gameLoopId) {
                            cancelAnimationFrame(gameLoopId);
                        }

                        // æ˜¾ç¤ºå¼€å§‹ç•Œé¢
                        document.getElementById('start-screen').style.display = 'flex';
                        document.getElementById('settings-modal').style.display = 'none';
                    });
                }

                // é‡æ–°å¼€å§‹
                const restartGameBtn = document.getElementById('restart-game-btn');
                if (restartGameBtn) {
                    restartGameBtn.addEventListener('click', () => {
                        // åœæ­¢æ¸¸æˆå¾ªç¯
                        if (gameLoopId) {
                            cancelAnimationFrame(gameLoopId);
                        }

                        // é‡æ–°å¼€å§‹æ¸¸æˆ
                        startGame();
                        document.getElementById('settings-modal').style.display = 'none';
                    });
                }

                // å…³é—­å¼¹çª—
                const closeSettingsBtn = document.getElementById('close-settings-btn');
                if (closeSettingsBtn) {
                    closeSettingsBtn.addEventListener('click', () => {
                        document.getElementById('settings-modal').style.display = 'none';
                    });
                }
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function init() {
            initEventListeners();
            draw(); // åˆå§‹ç»˜åˆ¶
        }

        // çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´ç”»å¸ƒ
        window.addEventListener('resize', function () {
            const gameContainer = document.getElementById('game-container');
            if (gameContainer) {
                canvasWidth = canvas.width = gameContainer.clientWidth;
                canvasHeight = canvas.height = gameContainer.clientHeight;

                // å¦‚æœå¼“å·²åˆå§‹åŒ–ï¼Œæ›´æ–°å…¶ä½ç½®
                if (bow) {
                    bow.x = canvasWidth / 2;
                    bow.y = canvasHeight - 50;
                }
            }
        });

        // å¯åŠ¨æ¸¸æˆ
        window.addEventListener('load', init);
    </script>
</body>

</html>