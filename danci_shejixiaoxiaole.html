<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿé™…äº‰éœ¸å•è¯åŒ¹é…æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            background-color: #1a237e;
            color: #ffffff;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            overflow: hidden;
            position: relative;
            margin: 0;
        }

        /* æ˜Ÿç©ºèƒŒæ™¯ */
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 0.3;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        /* æ ‡é¢˜æ ·å¼ */
        h1 {
            font-size: 1.8rem;
            color: #ffeb3b;
            margin: 5px 0;
            cursor: pointer;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
            z-index: 1;
            animation: title-float 3s ease-in-out infinite;
        }

        h1:hover {
            transform: scale(1.05);
            color: #fff176;
        }

        @keyframes title-float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        /* èœå•æ ·å¼ */
        .menu {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            max-width: 600px;
            margin: 5px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            z-index: 1;
        }

        /* æ»‘å—å®¹å™¨ */
        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .slider-container label {
            font-weight: bold;
            color: #bbdefb;
        }

        .slider-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ffeb3b;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: #fff176;
        }

        .slider-value {
            width: 60px;
            text-align: center;
            font-weight: bold;
            color: #ffeb3b;
        }

        /* æŒ‰é’®æ ·å¼ */
        .button-group {
            display: flex;
            gap: 10px;
        }

        button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #7b1fa2, #9c27b0);
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        /* ä¿¡æ¯åŒºåŸŸ */
        .info-area {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 600px;
            margin: 5px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            z-index: 1;
        }

        .info-item {
            font-weight: bold;
            color: #bbdefb;
        }

        .info-value {
            color: #ffeb3b;
            margin-left: 5px;
        }

        /* æ¸¸æˆåŒºåŸŸ */
        .game-area {
            position: relative;
            width: 100%;
            max-width: 800px;
            /* ä½¿ç”¨flex-growç¡®ä¿æ¸¸æˆåŒºåŸŸèƒ½å¤Ÿé€‚åº”å‰©ä½™ç©ºé—´ */
            flex-grow: 1;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            z-index: 1;
            /* è°ƒæ•´æœ€å¤§é«˜åº¦ï¼Œå¢åŠ æ¸¸æˆå¯ç©åŒºåŸŸ */
            max-height: calc(100vh - 150px);
        }

        /* æ•Œæœº */
        .enemy {
            position: absolute;
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #e91e63, #9c27b0);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            text-align: center;
            padding: 10px;
            animation: enemy-float 3s ease-in-out infinite;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .enemy:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.8);
        }

        @keyframes enemy-float {

            0%,
            100% {
                transform: translate(0, 0);
            }

            25% {
                transform: translate(20px, -10px);
            }

            50% {
                transform: translate(0, -20px);
            }

            75% {
                transform: translate(-20px, -10px);
            }
        }

        .enemy.explode {
            animation: explode 0.6s ease-in-out forwards;
        }

        @keyframes explode {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.5);
                opacity: 0.7;
                background: linear-gradient(45deg, #ff9800, #ff5722);
            }

            100% {
                transform: scale(0);
                opacity: 0;
            }
        }

        /* å‘å°„ä½ */
        .cannon {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 60px;
            background: linear-gradient(45deg, #2196f3, #0d47a1);
            border-radius: 20px 20px 5px 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .cannon::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 30px;
            background: linear-gradient(45deg, #1976d2, #0d47a1);
            border-radius: 10px 10px 0 0;
        }

        .cannon-barrel {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 40px;
            background: #64b5f6;
            border-radius: 5px;
            transition: all 0.3s ease;
            transform-origin: bottom center;
        }

        /* ç‚®å¼¹ */
        .projectile {
            position: absolute;
            width: 30px;
            height: 30px;
            background: linear-gradient(45deg, #ffeb3b, #ffc107);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-weight: bold;
            font-size: 0.7rem;
            text-align: center;
            padding: 5px;
            z-index: 3;
            transition: all 0.5s linear;
        }

        /* è½¨è¿¹çº¿ - å·²ç§»é™¤ */
        .trajectory {
            display: none !important;
            position: absolute;
            bottom: 65px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 300px;
            background: rgba(255, 235, 59, 0.5);
            pointer-events: none;
            z-index: 1;
            transition: all 0.1s ease;
            transform-origin: bottom center;
        }

        .trajectory::after {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 235, 59, 0.8);
        }

        /* å½“å‰å•è¯å®¹å™¨ */
        .current-word-container {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
        }

        /* åˆ·æ–°å›¾æ ‡ */
        .refresh-icon {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: -8px;
        }

        .refresh-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(33, 150, 243, 0.8);
        }

        /* å½“å‰å•è¯æ˜¾ç¤º */
        .current-word-display {
            padding: 5px 10px;
            background: rgba(255, 235, 59, 0.9);
            color: #333;
            font-weight: bold;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            min-width: 100px;
            text-align: center;
            transition: all 0.3s ease;
        }

        /* æ˜Ÿæ˜ŸåŠ¨ç”» */
        .star-effect {
            position: absolute;
            color: #ffeb3b;
            font-size: 20px;
            pointer-events: none;
            animation: star-effect 1s ease-out forwards;
            z-index: 4;
        }

        @keyframes star-effect {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }

            50% {
                transform: scale(1.5) rotate(180deg);
                opacity: 0.8;
            }

            100% {
                transform: scale(0) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes flash-effect {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
                box-shadow: 0 0 10px #ffeb3b, 0 0 20px #ffeb3b;
            }

            50% {
                transform: translate(-50%, -50%) scale(2);
                opacity: 0.8;
                box-shadow: 0 0 20px #ffeb3b, 0 0 40px #ffeb3b;
            }

            100% {
                transform: translate(-50%, -50%) scale(3);
                opacity: 0;
                box-shadow: 0 0 30px #ffeb3b, 0 0 60px #ffeb3b;
            }
        }

        /* é”™è¯¯æç¤º */
        .error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 5;
            animation: error-pulse 0.5s ease-in-out;
            display: none;
        }

        @keyframes error-pulse {

            0%,
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }

            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 0.8;
            }
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            animation: fade-in 0.3s ease;
        }

        @keyframes fade-in {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-content {
            background-color: rgba(26, 35, 126, 0.9);
            margin: 15% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            animation: slide-in 0.3s ease;
            border: 2px solid #ffeb3b;
        }

        @keyframes slide-in {
            from {
                transform: translateY(-50px) scale(0.8);
                opacity: 0;
            }

            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .modal h2 {
            color: #ffeb3b;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .modal p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #bbdefb;
        }

        .modal .info-value {
            color: #ffeb3b;
        }

        #continue-btn {
            background: linear-gradient(45deg, #4caf50, #2e7d32);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #continue-btn:hover {
            background: linear-gradient(45deg, #66bb6a, #2e7d32);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        /* éšè—æ–‡ä»¶è¾“å…¥ */
        #file-input {
            display: none;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .game-area {
                height: 400px;
            }

            h1 {
                font-size: 2rem;
            }

            .button-group {
                flex-direction: column;
            }

            .enemy {
                width: 60px;
                height: 60px;
                font-size: 0.7rem;
            }

            .cannon {
                width: 80px;
                height: 50px;
            }

            .direction-controls {
                bottom: 90px;
            }

            .fire-btn {
                bottom: 90px;
                width: 50px;
                height: 50px;
            }
        }
    </style>
</head>

<body>
    <!-- æ˜Ÿç©ºèƒŒæ™¯ -->
    <div class="stars" id="stars"></div>

    <!-- æ ‡é¢˜ -->
    <h1 id="game-title">æ˜Ÿé™…äº‰éœ¸å•è¯åŒ¹é…æ¸¸æˆ</h1>

    <!-- èœå• -->
    <div class="menu">
        <!-- å•è¯æ•°é‡æ»‘å— -->
        <div class="slider-container">
            <label for="word-count">å•è¯æ•°é‡ï¼ˆå¯¹ï¼‰ï¼š</label>
            <div class="slider-wrapper">
                <input type="range" id="word-count" min="5" max="50" value="10">
                <span class="slider-value" id="slider-value">10</span>
            </div>
        </div>

        <!-- æŒ‰é’®ç»„ -->
        <div class="button-group">
            <input type="file" id="file-input" accept=".xlsx,.xls,.csv">
            <button id="import-btn">å¯¼å…¥è¯è¡¨</button>
            <button id="start-btn">å¼€å§‹æ¸¸æˆ</button>
        </div>
    </div>

    <!-- ä¿¡æ¯åŒºåŸŸ -->
    <div class="info-area">
        <div class="info-item">
            è€—æ—¶ï¼š<span class="info-value" id="time-elapsed">0</span>ç§’
        </div>
        <div class="info-item">
            å¾—åˆ†ï¼š<span class="info-value" id="score">0</span>
        </div>
        <div class="info-item">
            å½“å‰å•è¯ï¼š<span class="info-value" id="current-word">å‡†å¤‡ä¸­</span>
        </div>
    </div>

    <!-- æ¸¸æˆåŒºåŸŸ -->
    <div class="game-area" id="game-area">
        <!-- å‘å°„ä½ -->
        <div class="cannon" id="cannon">
            <div class="cannon-barrel" id="cannon-barrel"></div>
        </div>

        <!-- è½¨è¿¹çº¿ -->
        <div class="trajectory" id="trajectory"></div>

        <!-- å½“å‰å•è¯æ˜¾ç¤º -->
        <div class="current-word-container">
            <div class="refresh-icon" id="refresh-icon">ğŸ”„</div>
            <div class="current-word-display" id="current-word-display">å‡†å¤‡ä¸­</div>
        </div>

        <!-- é”™è¯¯æç¤º -->
        <div class="error-message" id="error-message">æ”»å‡»å¤±è´¥ï¼</div>
    </div>

    <!-- æ¸¸æˆç»“æŸæ¨¡æ€æ¡† -->
    <div class="modal" id="game-over-modal">
        <div class="modal-content">
            <h2>æ­å–œå®Œæˆä»»åŠ¡ï¼</h2>
            <p>è€—æ—¶ï¼š<span class="info-value" id="final-time">0</span>ç§’</p>
            <p>å¾—åˆ†ï¼š<span class="info-value" id="final-score">0</span></p>
            <button id="continue-btn">ç»§ç»­æŒ‘æˆ˜</button>
        </div>
    </div>

    <script>
        // é»˜è®¤è¯åº“
        const defaultWordList = [
            ['apple', 'è‹¹æœ'],
            ['banana', 'é¦™è•‰'],
            ['cat', 'çŒ«'],
            ['dog', 'ç‹—'],
            ['elephant', 'å¤§è±¡'],
            ['fish', 'é±¼'],
            ['grape', 'è‘¡è„'],
            ['house', 'æˆ¿å­'],
            ['ice', 'å†°'],
            ['juice', 'æœæ±'],
            ['kite', 'é£ç­'],
            ['lion', 'ç‹®å­'],
            ['milk', 'ç‰›å¥¶'],
            ['notebook', 'ç¬”è®°æœ¬'],
            ['orange', 'æ©™å­'],
            ['pen', 'é’¢ç¬”'],
            ['queen', 'å¥³ç‹'],
            ['rabbit', 'å…”å­'],
            ['sun', 'å¤ªé˜³'],
            ['tree', 'æ ‘'],
            ['umbrella', 'é›¨ä¼'],
            ['violin', 'å°æç´'],
            ['water', 'æ°´'],
            ['xylophone', 'æœ¨ç´'],
            ['yellow', 'é»„è‰²'],
            ['zebra', 'æ–‘é©¬'],
            ['book', 'ä¹¦'],
            ['computer', 'ç”µè„‘'],
            ['desk', 'ä¹¦æ¡Œ'],
            ['chair', 'æ¤…å­']
        ];

        // å…¨å±€å˜é‡
        let wordList = []; // å•è¯åˆ—è¡¨
        let currentPairs = 10; // å½“å‰å•è¯å¯¹æ•°
        let currentIndex = 0; // å½“å‰å•è¯ç´¢å¼•
        let gameStarted = false; // æ¸¸æˆæ˜¯å¦å¼€å§‹
        let timer = 0; // è®¡æ—¶å™¨
        let timerInterval = null; // è®¡æ—¶å™¨é—´éš”
        let score = 0; // å¾—åˆ†
        let currentWord = ""; // å½“å‰ç‚®å¼¹å•è¯
        let currentMeaning = ""; // å½“å‰ç‚®å¼¹å•è¯çš„ç¿»è¯‘
        let enemies = []; // å½“å‰æ•Œæœºåˆ—è¡¨
        let cannonAngle = 0; // å¤§ç‚®è§’åº¦
        let gameTitle = "æ˜Ÿé™…äº‰éœ¸å•è¯åŒ¹é…æ¸¸æˆ"; // æ¸¸æˆæ ‡é¢˜

        // DOMå…ƒç´ 
        let gameTitleEl, wordCountEl, sliderValueEl, importBtnEl, startBtnEl;
        let timeElapsedEl, scoreEl, currentWordEl, gameAreaEl, cannonEl;
        let cannonBarrelEl, fireBtnEl, errorMessageEl, gameOverModalEl;
        let finalTimeEl, finalScoreEl, continueBtnEl, fileInputEl;
        let starsEl, trajectoryEl, currentWordDisplayEl, refreshIconEl;

        // å¤„ç†æŒ‡é’ˆç§»åŠ¨ï¼ˆé¼ æ ‡æˆ–è§¦æ‘¸ï¼‰
        function handlePointerMove(x, y) {
            // ç§»é™¤è½¨è¿¹çº¿æ˜¾ç¤º
            trajectoryEl.style.display = 'none';

            const gameAreaRect = gameAreaEl.getBoundingClientRect();
            const cannonRect = cannonEl.getBoundingClientRect();
            const cannonX = cannonRect.left + cannonRect.width / 2;
            const cannonY = cannonRect.top;

            // è®¡ç®—è§’åº¦
            let angle = Math.atan2(x - cannonX, cannonY - y) * (180 / Math.PI);

            // é™åˆ¶è§’åº¦èŒƒå›´ä¸º180åº¦
            angle = Math.max(Math.min(angle, 90), -90);

            cannonAngle = angle;

            // ä¸å†æ›´æ–°è½¨è¿¹çº¿é•¿åº¦ï¼Œå› ä¸ºè½¨è¿¹çº¿å·²è¢«ç§»é™¤
            // æ›´æ–°å¤§ç‚®è§’åº¦
            updateCannonAngle();
        }

        // åˆå§‹åŒ–
        function init() {
            // è·å–DOMå…ƒç´ 
            gameTitleEl = document.getElementById('game-title');
            wordCountEl = document.getElementById('word-count');
            sliderValueEl = document.getElementById('slider-value');
            importBtnEl = document.getElementById('import-btn');
            startBtnEl = document.getElementById('start-btn');
            timeElapsedEl = document.getElementById('time-elapsed');
            scoreEl = document.getElementById('score');
            currentWordEl = document.getElementById('current-word');
            gameAreaEl = document.getElementById('game-area');
            cannonEl = document.getElementById('cannon');
            cannonBarrelEl = document.getElementById('cannon-barrel');
            fireBtnEl = document.getElementById('fire-btn');
            errorMessageEl = document.getElementById('error-message');
            gameOverModalEl = document.getElementById('game-over-modal');
            finalTimeEl = document.getElementById('final-time');
            finalScoreEl = document.getElementById('final-score');
            continueBtnEl = document.getElementById('continue-btn');
            fileInputEl = document.getElementById('file-input');
            starsEl = document.getElementById('stars');
            trajectoryEl = document.getElementById('trajectory');
            currentWordDisplayEl = document.getElementById('current-word-display');
            refreshIconEl = document.getElementById('refresh-icon');

            // åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯
            createStars();

            // åŠ è½½æœ¬åœ°å­˜å‚¨æ•°æ®
            loadFromLocalStorage();

            // ç»‘å®šäº‹ä»¶
            bindEvents();
        }

        // åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯
        function createStars() {
            // å‡å°‘æ˜Ÿæ˜Ÿæ•°é‡ä»¥æé«˜ç§»åŠ¨è®¾å¤‡æ€§èƒ½
            for (let i = 0; i < 30; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsEl.appendChild(star);
            }
        }

        // åŠ è½½æœ¬åœ°å­˜å‚¨æ•°æ®
        function loadFromLocalStorage() {
            const savedWordList = localStorage.getItem('wordList');
            const savedTitle = localStorage.getItem('gameTitle');

            if (savedWordList) {
                wordList = JSON.parse(savedWordList);
            } else {
                // å¦‚æœæ²¡æœ‰ä¿å­˜çš„è¯åº“ï¼Œä½¿ç”¨é»˜è®¤è¯åº“
                wordList = shuffleArray([...defaultWordList]);
                saveToLocalStorage();
            }

            if (savedTitle) {
                gameTitle = savedTitle;
                gameTitleEl.textContent = gameTitle;
            }
        }

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveToLocalStorage() {
            localStorage.setItem('wordList', JSON.stringify(wordList));
            localStorage.setItem('gameTitle', gameTitle);
        }

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // æ ‡é¢˜ç‚¹å‡»äº‹ä»¶
            gameTitleEl.addEventListener('click', function () {
                const newTitle = prompt('è¯·è¾“å…¥æ–°çš„æ¸¸æˆæ ‡é¢˜ï¼š', gameTitle);
                if (newTitle) {
                    gameTitle = newTitle;
                    gameTitleEl.textContent = gameTitle;
                    saveToLocalStorage();
                }
            });

            // æ»‘å—äº‹ä»¶
            wordCountEl.addEventListener('input', function () {
                currentPairs = parseInt(this.value);
                sliderValueEl.textContent = currentPairs;
            });

            // å¯¼å…¥æŒ‰é’®äº‹ä»¶
            importBtnEl.addEventListener('click', function () {
                fileInputEl.click();
            });
            // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
            importBtnEl.addEventListener('touchstart', function (e) {
                // ç›´æ¥æ‰§è¡Œç‚¹å‡»æ“ä½œï¼Œç§»é™¤e.preventDefault()ä»¥é¿å…é˜»æ­¢é¡µé¢æ»šåŠ¨
                this.click();
            });

            // æ–‡ä»¶è¾“å…¥äº‹ä»¶
            fileInputEl.addEventListener('change', handleFileImport);

            // å¼€å§‹æ¸¸æˆæŒ‰é’®äº‹ä»¶
            startBtnEl.addEventListener('click', function () {
                console.log('å¼€å§‹æ¸¸æˆæŒ‰é’®ç‚¹å‡»');
                startGame();
                console.log('æ¸¸æˆæ˜¯å¦å¼€å§‹:', gameStarted);
            });
            // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
            startBtnEl.addEventListener('touchstart', function (e) {
                console.log('å¼€å§‹æ¸¸æˆæŒ‰é’®è§¦æ‘¸');
                // ç›´æ¥æ‰§è¡Œç‚¹å‡»æ“ä½œï¼Œç§»é™¤e.preventDefault()ä»¥é¿å…é˜»æ­¢é¡µé¢æ»šåŠ¨
                this.click();
                console.log('æ¸¸æˆæ˜¯å¦å¼€å§‹:', gameStarted);
            });

            // é¼ æ ‡ç§»åŠ¨äº‹ä»¶ï¼ˆæ§åˆ¶æ–¹å‘å’Œè½¨è¿¹çº¿é•¿åº¦ï¼‰
            gameAreaEl.addEventListener('mousemove', function (e) {
                if (gameStarted) {
                    handlePointerMove(e.clientX, e.clientY);
                }
            });

            // è§¦æ‘¸ç§»åŠ¨äº‹ä»¶ï¼ˆæ§åˆ¶æ–¹å‘å’Œè½¨è¿¹çº¿é•¿åº¦ï¼‰
            gameAreaEl.addEventListener('touchmove', function (e) {
                if (gameStarted) {
                    // ç§»é™¤e.preventDefault()ä»¥é¿å…é˜»æ­¢é¡µé¢æ»šåŠ¨
                    const touch = e.touches[0];
                    handlePointerMove(touch.clientX, touch.clientY);
                }
            }, { passive: true });

            // ç»Ÿä¸€å¤„ç†ç‚¹å‡»å’Œè§¦æ‘¸äº‹ä»¶
            function handleGameAreaClick(e) {
                console.log('handleGameAreaClickå‡½æ•°è¢«è°ƒç”¨');

                if (!gameStarted) {
                    console.log('æ¸¸æˆæœªå¼€å§‹ï¼Œè¿”å›');
                    return;
                }

                // è°ƒè¯•ä¿¡æ¯
                console.log('ç‚¹å‡»äº‹ä»¶è§¦å‘ï¼Œç›®æ ‡:', e.target);
                console.log('ç›®æ ‡ç±»å:', e.target.className);
                console.log('ç›®æ ‡HTML:', e.target.outerHTML);

                // æ£€æŸ¥ç‚¹å‡»çš„ç›®æ ‡æ˜¯å¦æ˜¯åˆ·æ–°å›¾æ ‡
                if (e.target.closest('.refresh-icon')) {
                    console.log('ç‚¹å‡»äº†åˆ·æ–°å›¾æ ‡ï¼Œè¿”å›');
                    return;
                }

                // ç®€åŒ–çš„æ•Œæœºæ£€æµ‹é€»è¾‘
                let isEnemy = false;
                let targetEnemy = null;

                // æ£€æŸ¥å½“å‰ç›®æ ‡æ˜¯å¦æ˜¯æ•Œæœº
                if (e.target.classList.contains('enemy')) {
                    console.log('å½“å‰ç›®æ ‡æ˜¯æ•Œæœº');
                    isEnemy = true;
                    targetEnemy = e.target;
                } else {
                    console.log('å½“å‰ç›®æ ‡ä¸æ˜¯æ•Œæœºï¼Œæ£€æŸ¥çˆ¶å…ƒç´ ');
                    // æ£€æŸ¥çˆ¶å…ƒç´ æ˜¯å¦æ˜¯æ•Œæœº
                    let parent = e.target.parentElement;
                    console.log('çˆ¶å…ƒç´ :', parent);

                    while (parent && parent !== gameAreaEl) {
                        console.log('æ£€æŸ¥çˆ¶å…ƒç´ :', parent, 'ç±»å:', parent.className);
                        if (parent.classList.contains('enemy')) {
                            console.log('çˆ¶å…ƒç´ æ˜¯æ•Œæœº');
                            isEnemy = true;
                            targetEnemy = parent;
                            break;
                        }
                        parent = parent.parentElement;
                        console.log('ä¸‹ä¸€ä¸ªçˆ¶å…ƒç´ :', parent);
                    }
                }

                console.log('æ˜¯å¦æ˜¯æ•Œæœº:', isEnemy);

                // å¼ºåˆ¶è¿›å…¥æ•Œæœºå¤„ç†é€»è¾‘ï¼Œç”¨äºæµ‹è¯•
                isEnemy = true;
                targetEnemy = e.target.closest('.enemy');
                console.log('å¼ºåˆ¶è®¾ç½®isEnemy:', isEnemy, 'targetEnemy:', targetEnemy);

                if (isEnemy && targetEnemy) {
                    console.log('ç‚¹å‡»äº†æ•Œæœº:', targetEnemy);
                    // è®¡ç®—ç‚¹å‡»ä½ç½®ä¸ç‚®ç®¡çš„è§’åº¦
                    const enemyRect = targetEnemy.getBoundingClientRect();
                    const enemyCenterX = enemyRect.left + enemyRect.width / 2;
                    const enemyCenterY = enemyRect.top + enemyRect.height / 2;

                    console.log('æ•Œæœºä¸­å¿ƒä½ç½®:', enemyCenterX, enemyCenterY);

                    const cannonRect = cannonEl.getBoundingClientRect();
                    const cannonX = cannonRect.left + cannonRect.width / 2;
                    const cannonY = cannonRect.top;

                    console.log('å¤§ç‚®ä½ç½®:', cannonX, cannonY);

                    // è®¡ç®—è§’åº¦
                    let angle = Math.atan2(enemyCenterX - cannonX, cannonY - enemyCenterY) * (180 / Math.PI);

                    console.log('è®¡ç®—çš„è§’åº¦ï¼ˆå¼§åº¦ï¼‰:', Math.atan2(enemyCenterX - cannonX, cannonY - enemyCenterY));
                    console.log('è®¡ç®—çš„è§’åº¦ï¼ˆåº¦ï¼‰:', angle);

                    // é™åˆ¶è§’åº¦èŒƒå›´
                    angle = Math.max(Math.min(angle, 90), -90);

                    console.log('é™åˆ¶åçš„è§’åº¦:', angle);

                    // æ›´æ–°å¤§ç‚®è§’åº¦
                    console.log('æ›´æ–°å¤§ç‚®è§’åº¦å‰:', cannonAngle);
                    cannonAngle = angle;
                    console.log('æ›´æ–°å¤§ç‚®è§’åº¦å:', cannonAngle);
                    updateCannonAngle();

                    // å‘å°„ç‚®å¼¹
                    console.log('å‡†å¤‡å‘å°„ç‚®å¼¹');
                    fireProjectile();
                    console.log('ç‚®å¼¹å‘å°„å®Œæˆ');
                } else {
                    // æ™®é€šç‚¹å‡»ï¼Œç›´æ¥å‘å°„ç‚®å¼¹
                    console.log('æ™®é€šç‚¹å‡»ï¼Œå‘å°„ç‚®å¼¹');
                    fireProjectile();
                }
            }

            // é¼ æ ‡å·¦é”®ç‚¹å‡»äº‹ä»¶ï¼ˆå‘å°„ç‚®å¼¹ï¼‰
            gameAreaEl.addEventListener('click', handleGameAreaClick);

            // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
            gameAreaEl.addEventListener('touchstart', function (e) {
                console.log('è§¦æ‘¸äº‹ä»¶è§¦å‘');

                // è·å–è§¦æ‘¸ç‚¹
                const touch = e.touches[0];
                console.log('è§¦æ‘¸ç‚¹:', touch);

                // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œé¿å…é¡µé¢æ»šåŠ¨
                e.preventDefault();

                // åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„ç‚¹å‡»äº‹ä»¶ï¼Œä½¿ç”¨è§¦æ‘¸ç‚¹çš„ä½ç½®
                const clickEvent = new MouseEvent('click', {
                    clientX: touch.clientX,
                    clientY: touch.clientY,
                    bubbles: true,
                    cancelable: true,
                    view: window
                });

                // è§¦å‘ç‚¹å‡»äº‹ä»¶
                touch.target.dispatchEvent(clickEvent);
            }, { passive: false });

            // åˆ·æ–°å›¾æ ‡ç‚¹å‡»äº‹ä»¶
            refreshIconEl.addEventListener('click', function () {
                if (gameStarted) {
                    // åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå•è¯
                    currentIndex = (currentIndex + 1) % wordList.length;
                    setCurrentWord();
                }
            });
            // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
            refreshIconEl.addEventListener('touchstart', function (e) {
                // ç›´æ¥æ‰§è¡Œç‚¹å‡»æ“ä½œï¼Œç§»é™¤e.preventDefault()ä»¥é¿å…é˜»æ­¢é¡µé¢æ»šåŠ¨
                this.click();
            });

            // ç»§ç»­æŒ‘æˆ˜æŒ‰é’®äº‹ä»¶
            continueBtnEl.addEventListener('click', continueChallenge);
            // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
            continueBtnEl.addEventListener('touchstart', function (e) {
                // ç›´æ¥æ‰§è¡Œç‚¹å‡»æ“ä½œï¼Œç§»é™¤e.preventDefault()ä»¥é¿å…é˜»æ­¢é¡µé¢æ»šåŠ¨
                this.click();
            });
        }

        // æ›´æ–°å¤§ç‚®è§’åº¦
        function updateCannonAngle() {
            console.log('æ›´æ–°å¤§ç‚®è§’åº¦å‡½æ•°è¢«è°ƒç”¨');
            console.log('cannonBarrelEl:', cannonBarrelEl);
            console.log('cannonAngle:', cannonAngle);

            if (cannonBarrelEl) {
                cannonBarrelEl.style.transform = `translateX(-50%) rotate(${cannonAngle}deg)`;
                console.log('ç‚®ç®¡è§’åº¦å·²æ›´æ–°');
            } else {
                console.error('cannonBarrelEl ä¸º null æˆ– undefined');
            }

            // ç§»é™¤è½¨è¿¹çº¿ç›¸å…³ä»£ç ï¼Œå› ä¸ºè½¨è¿¹çº¿å·²è¢«ç§»é™¤
        }

        // å¤„ç†æ–‡ä»¶å¯¼å…¥
        function handleFileImport(e) {
            const file = e.target.files[0];
            if (!file) return;

            // ç”±äºæ²¡æœ‰ç¬¬ä¸‰æ–¹åº“ï¼Œè¿™é‡Œæ¨¡æ‹ŸExcelè§£æ
            // å®é™…é¡¹ç›®ä¸­éœ€è¦ä½¿ç”¨xlsxåº“è§£æExcelæ–‡ä»¶
            // è¿™é‡Œæˆ‘ä»¬å‡è®¾æ–‡ä»¶å†…å®¹æ˜¯CSVæ ¼å¼ï¼Œç¬¬ä¸€åˆ—å•è¯ï¼Œç¬¬äºŒåˆ—æ˜¯ç­”æ¡ˆ
            const reader = new FileReader();
            reader.onload = function (e) {
                const content = e.target.result;
                const lines = content.split('\n');
                const newWordList = [];

                for (let line of lines) {
                    if (line.trim()) {
                        const parts = line.split('\t'); // å‡è®¾ä½¿ç”¨åˆ¶è¡¨ç¬¦åˆ†éš”
                        if (parts.length >= 2) {
                            newWordList.push([parts[0].trim(), parts[1].trim()]);
                        }
                    }
                }

                if (newWordList.length > 0) {
                    wordList = shuffleArray(newWordList);
                    currentIndex = 0;
                    saveToLocalStorage();
                    alert('è¯è¡¨å¯¼å…¥æˆåŠŸï¼');
                } else {
                    alert('è¯è¡¨æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶ï¼');
                }
            };
            reader.readAsText(file);
        }

        // æ‰“ä¹±æ•°ç»„
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (!gameStarted) {
                // å¼€å§‹æ–°æ¸¸æˆ
                gameStarted = true;
                startBtnEl.textContent = 'é‡æ–°å¼€å§‹ï¼ˆé‡ç½®è¯æ±‡ï¼‰';
                currentIndex = 0;
                score = 0;
                scoreEl.textContent = score;
                startTimer();
                initGame();
                console.log('æ¸¸æˆå·²å¼€å§‹ï¼ŒgameStarted:', gameStarted);
            } else {
                // é‡æ–°å¼€å§‹
                resetGame();
                // é‡ç½®åéœ€è¦é‡æ–°è®¾ç½®gameStartedä¸ºtrue
                gameStarted = true;
                wordList = shuffleArray(wordList);
                currentIndex = 0;
                score = 0;
                scoreEl.textContent = score;
                startTimer();
                initGame();
                console.log('æ¸¸æˆå·²é‡æ–°å¼€å§‹ï¼ŒgameStarted:', gameStarted);
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // æ¸…é™¤ç°æœ‰æ•Œæœº
            clearEnemies();

            // è®¡ç®—éœ€è¦æ˜¾ç¤ºçš„å•è¯
            const endIndex = Math.min(currentIndex + currentPairs, wordList.length);

            // ç”Ÿæˆæ•Œæœº
            generateEnemies(endIndex);

            // è®¾ç½®å½“å‰å•è¯
            setCurrentWord();
        }

        // æ¸…é™¤ç°æœ‰æ•Œæœº
        function clearEnemies() {
            enemies.forEach(enemy => {
                if (enemy.element) {
                    enemy.element.remove();
                }
            });
            enemies = [];
        }

        // ç”Ÿæˆæ•Œæœº
        function generateEnemies(endIndex) {
            for (let i = currentIndex; i < endIndex; i++) {
                const [word, meaning] = wordList[i];
                createEnemy(meaning, i);
            }
        }

        // åˆ›å»ºæ•Œæœº
        function createEnemy(meaning, index) {
            const enemy = document.createElement('div');
            enemy.className = 'enemy';
            enemy.textContent = meaning;

            // å®šä¹‰æ°”æ³¡é¢œè‰²æ•°ç»„ï¼ŒåŒ…å«å¤šç§é²œè‰³çš„é¢œè‰²
            const bubbleColors = [
                'linear-gradient(45deg, #e91e63, #9c27b0)',
                'linear-gradient(45deg, #ff9800, #ff5722)',
                'linear-gradient(45deg, #2196f3, #03a9f4)',
                'linear-gradient(45deg, #4caf50, #43a047)',
                'linear-gradient(45deg, #f44336, #e53935)',
                'linear-gradient(45deg, #9c27b0, #8e24aa)',
                'linear-gradient(45deg, #ffc107, #ffb300)',
                'linear-gradient(45deg, #00bcd4, #00acc1)',
                'linear-gradient(45deg, #795548, #6d4c41)',
                'linear-gradient(45deg, #607d8b, #546e7a)'
            ];

            // éšæœºé€‰æ‹©ä¸€ç§é¢œè‰²
            const randomColor = bubbleColors[Math.floor(Math.random() * bubbleColors.length)];

            // æ ¹æ®æ±‰å­—é•¿åº¦è°ƒæ•´æ°”æ³¡å¤§å°ï¼Œæ±‰å­—è¶Šå¤šï¼Œæ°”æ³¡è¶Šå¤§ï¼Œä½†å°½é‡å°ä¸€ç‚¹
            // åŸºç¡€å¤§å°ä¸º40pxï¼Œæ¯ä¸ªæ±‰å­—å¢åŠ 5px
            const baseSize = 40;
            const sizePerChar = 5;
            // è®¡ç®—æ°”æ³¡å¤§å°ï¼Œé™åˆ¶åœ¨40-80pxä¹‹é—´
            const enemySize = Math.min(Math.max(baseSize + (meaning.length * sizePerChar), 40), 80);
            const padding = 15; // å‡å°‘é—´è·ï¼Œæ˜¾ç¤ºæ›´å¤šæ°”æ³¡

            // è®¾ç½®æ•Œæœºå¤§å°
            enemy.style.width = enemySize + 'px';
            enemy.style.height = enemySize + 'px';
            // è®¾ç½®éšæœºèƒŒæ™¯é¢œè‰²
            enemy.style.background = randomColor;
            // å¢å¤§å­—ä½“å¤§å°ï¼Œç¡®ä¿æ¸…æ™°å¯è§ï¼Œæœ€å°12px
            const fontSize = Math.max(Math.floor(enemySize / 5), 12);
            enemy.style.fontSize = fontSize + 'px'; // æ ¹æ®å¤§å°è°ƒæ•´å­—ä½“

            // éšæœºä½ç½®ï¼Œç¡®ä¿ä¸ä¸å…¶ä»–æ•Œæœºé‡å 
            let x, y;
            let isOverlapping;
            let maxAttempts = 200; // å¢åŠ æœ€å¤§å°è¯•æ¬¡æ•°ï¼Œç¡®ä¿åœ¨æ˜¾ç¤ºæ›´å¤šæ°”æ³¡æ—¶èƒ½å¤Ÿæ‰¾åˆ°ä¸é‡å çš„ä½ç½®
            let attempts = 0;

            do {
                attempts++;
                isOverlapping = false;
                x = Math.random() * (gameAreaEl.clientWidth - enemySize - padding * 2) + padding;
                y = Math.random() * 200 + padding;

                // æ£€æŸ¥æ˜¯å¦ä¸å…¶ä»–æ•Œæœºé‡å 
                for (let existingEnemy of enemies) {
                    const existingSize = parseInt(existingEnemy.element.style.width) || 80;
                    const dx = x - existingEnemy.x;
                    const dy = y - existingEnemy.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    const minDistance = (enemySize + existingSize) / 2 + padding;

                    if (distance < minDistance) {
                        isOverlapping = true;
                        break;
                    }
                }
            } while (isOverlapping && attempts < maxAttempts);

            enemy.style.left = x + 'px';
            enemy.style.top = y + 'px';

            // éšæœºåŠ¨ç”»å»¶è¿Ÿ
            enemy.style.animationDelay = Math.random() * 2 + 's';

            // ç§»é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œä½¿ç”¨æ¸¸æˆåŒºåŸŸçš„ç»Ÿä¸€äº‹ä»¶å¤„ç†
            // è¿™æ ·å¯ä»¥é¿å…äº‹ä»¶å†’æ³¡å’Œæ‹¦æˆªé—®é¢˜

            gameAreaEl.appendChild(enemy);

            // æ·»åŠ åˆ°æ•Œæœºåˆ—è¡¨
            enemies.push({
                id: `enemy-${index}`,
                word: meaning,
                originalWord: wordList[index][0],
                element: enemy,
                x: x,
                y: y,
                size: enemySize
            });
        }

        // è®¾ç½®å½“å‰å•è¯
        function setCurrentWord() {
            if (currentIndex < wordList.length) {
                const [word, meaning] = wordList[currentIndex];
                currentWord = word;
                currentMeaning = meaning;
                currentWordEl.textContent = currentWord;
                currentWordDisplayEl.textContent = currentWord;
            } else {
                currentWord = "æ¸¸æˆç»“æŸ";
                currentMeaning = "";
                currentWordEl.textContent = currentWord;
                currentWordDisplayEl.textContent = currentWord;
            }
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            gameStarted = false;
            clearInterval(timerInterval);
            timer = 0;
            timeElapsedEl.textContent = timer;
            score = 0;
            scoreEl.textContent = score;
            clearEnemies();
            cannonAngle = 0;
            updateCannonAngle();
            // éšè—è½¨è¿¹çº¿
            trajectoryEl.style.display = 'none';
            // æ›´æ–°å½“å‰å•è¯æ˜¾ç¤º
            currentWordDisplayEl.textContent = "å‡†å¤‡ä¸­";
        }

        // å¼€å§‹è®¡æ—¶
        function startTimer() {
            clearInterval(timerInterval);
            timer = 0;
            timeElapsedEl.textContent = timer;
            timerInterval = setInterval(function () {
                timer++;
                timeElapsedEl.textContent = timer;
            }, 1000);
        }

        // åœæ­¢è®¡æ—¶
        function stopTimer() {
            clearInterval(timerInterval);
        }

        // å‘å°„ç‚®å¼¹
        function fireProjectile() {
            console.log('å‘å°„ç‚®å¼¹å‡½æ•°è¢«è°ƒç”¨');

            if (!gameStarted) {
                console.log('æ¸¸æˆæœªå¼€å§‹ï¼Œè¿”å›');
                return;
            }

            console.log('currentWord:', currentWord);
            console.log('cannonAngle:', cannonAngle);

            // åˆ›å»ºç‚®å¼¹
            const projectile = document.createElement('div');
            projectile.className = 'projectile';
            projectile.textContent = currentWord;

            console.log('åˆ›å»ºçš„ç‚®å¼¹:', projectile);

            // è®¾ç½®åˆå§‹ä½ç½®
            const cannonRect = cannonEl.getBoundingClientRect();
            const gameAreaRect = gameAreaEl.getBoundingClientRect();

            console.log('cannonRect:', cannonRect);
            console.log('gameAreaRect:', gameAreaRect);

            const startX = cannonRect.left + cannonRect.width / 2 - gameAreaRect.left;
            const startY = cannonRect.top - gameAreaRect.top;

            console.log('åˆå§‹ä½ç½®:', startX, startY);

            projectile.style.left = startX + 'px';
            projectile.style.top = startY + 'px';

            gameAreaEl.appendChild(projectile);
            console.log('ç‚®å¼¹å·²æ·»åŠ åˆ°æ¸¸æˆåŒºåŸŸ');

            // è®¡ç®—ç›®æ ‡ä½ç½®ï¼ˆåŸºäºè§’åº¦ï¼‰
            const angleRad = (cannonAngle * Math.PI) / 180;
            const distance = 500;
            const endX = startX + Math.sin(angleRad) * distance;
            const endY = startY - Math.cos(angleRad) * distance;

            console.log('ç›®æ ‡ä½ç½®:', endX, endY);

            // è®¾ç½®è¿‡æ¸¡åŠ¨ç”»æ—¶é—´
            projectile.style.transition = 'all 1s linear';
            console.log('è®¾ç½®è¿‡æ¸¡åŠ¨ç”»æ—¶é—´');

            // åŠ¨ç”»
            setTimeout(() => {
                console.log('æ‰§è¡Œç‚®å¼¹åŠ¨ç”»');
                projectile.style.left = endX + 'px';
                projectile.style.top = endY + 'px';
            }, 10);

            // æŒç»­æ£€æµ‹ç¢°æ’
            const collisionCheckInterval = setInterval(() => {
                console.log('æ£€æµ‹ç¢°æ’');
                if (checkCollision(projectile)) {
                    console.log('å‘ç”Ÿç¢°æ’ï¼Œæ¸…é™¤æ£€æµ‹é—´éš”');
                    clearInterval(collisionCheckInterval);
                }
            }, 50);

            // 1.5ç§’åå¦‚æœè¿˜æ²¡ç¢°æ’ï¼Œç§»é™¤ç‚®å¼¹
            setTimeout(() => {
                console.log('1.5ç§’åç§»é™¤ç‚®å¼¹');
                if (projectile.parentNode) {
                    projectile.remove();
                    console.log('ç‚®å¼¹å·²ç§»é™¤');
                }
            }, 1500);
        }

        // æ£€æµ‹ç¢°æ’
        function checkCollision(projectile) {
            let collision = false;
            let collidedEnemy = null;

            enemies.forEach(enemy => {
                if (!enemy.hit) {
                    const enemyRect = enemy.element.getBoundingClientRect();
                    const projectileRect = projectile.getBoundingClientRect();

                    // ç®€å•çš„ç¢°æ’æ£€æµ‹
                    if (
                        projectileRect.left < enemyRect.right &&
                        projectileRect.right > enemyRect.left &&
                        projectileRect.top < enemyRect.bottom &&
                        projectileRect.bottom > enemyRect.top
                    ) {
                        collision = true;
                        collidedEnemy = enemy;
                    }
                }
            });

            if (collision && collidedEnemy) {
                // æ£€æŸ¥æ˜¯å¦åŒ¹é…
                if (collidedEnemy.originalWord === currentWord) {
                    // åŒ¹é…æˆåŠŸ
                    handleMatch(collidedEnemy, projectile);
                } else {
                    // åŒ¹é…å¤±è´¥
                    handleMismatch(projectile);
                }
                return true; // å‘ç”Ÿç¢°æ’
            } else {
                // æ²¡æœ‰ç¢°æ’
                return false; // æœªå‘ç”Ÿç¢°æ’
            }
        }

        // å¤„ç†åŒ¹é…æˆåŠŸ
        function handleMatch(enemy, projectile) {
            // æ ‡è®°æ•Œæœºä¸ºå·²å‡»ä¸­
            enemy.hit = true;

            // æ’­æ”¾ç¢°æ’ç‰¹æ•ˆ
            createCollisionEffect(projectile);

            // æ’­æ”¾çˆ†ç‚¸åŠ¨ç”»
            enemy.element.classList.add('explode');

            // åˆ›å»ºæ˜Ÿæ˜Ÿæ•ˆæœ
            createStarEffects(enemy.element);

            // åŠ åˆ†
            score += 10;
            scoreEl.textContent = score;

            // ç§»é™¤ç‚®å¼¹
            projectile.remove();

            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æ•Œæœºéƒ½è¢«å‡»ä¸­
            setTimeout(() => {
                enemy.element.remove();
                checkGameComplete();
            }, 600);
        }

        // å¤„ç†åŒ¹é…å¤±è´¥
        function handleMismatch(projectile) {
            // æ˜¾ç¤ºé”™è¯¯æç¤º
            errorMessageEl.style.display = 'block';

            setTimeout(() => {
                errorMessageEl.style.display = 'none';
            }, 1000);

            // ç§»é™¤ç‚®å¼¹
            projectile.remove();
        }

        // åˆ›å»ºæ˜Ÿæ˜Ÿæ•ˆæœ
        function createStarEffects(element) {
            const rect = element.getBoundingClientRect();
            const gameAreaRect = gameAreaEl.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2 - gameAreaRect.left;
            const centerY = rect.top + rect.height / 2 - gameAreaRect.top;

            // åˆ›å»º5ä¸ªæ˜Ÿæ˜Ÿ
            for (let i = 0; i < 5; i++) {
                const star = document.createElement('div');
                star.className = 'star-effect';
                star.textContent = 'â˜…';

                // éšæœºä½ç½®
                const angle = (Math.PI * 2 / 5) * i;
                const distance = Math.random() * 30 + 20;
                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;

                star.style.left = x + 'px';
                star.style.top = y + 'px';
                star.style.animationDelay = (i * 0.1) + 's';

                gameAreaEl.appendChild(star);

                // åŠ¨ç”»ç»“æŸåç§»é™¤æ˜Ÿæ˜Ÿ
                setTimeout(() => {
                    star.remove();
                }, 1000);
            }
        }

        // åˆ›å»ºç¢°æ’ç‰¹æ•ˆ
        function createCollisionEffect(projectile) {
            const rect = projectile.getBoundingClientRect();
            const gameAreaRect = gameAreaEl.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2 - gameAreaRect.left;
            const centerY = rect.top + rect.height / 2 - gameAreaRect.top;

            // åˆ›å»ºç¢°æ’é—ªå…‰æ•ˆæœ
            const flash = document.createElement('div');
            flash.style.position = 'absolute';
            flash.style.left = centerX + 'px';
            flash.style.top = centerY + 'px';
            flash.style.width = '30px';
            flash.style.height = '30px';
            flash.style.backgroundColor = '#ffeb3b';
            flash.style.borderRadius = '50%';
            flash.style.transform = 'translate(-50%, -50%)';
            flash.style.opacity = '1';
            flash.style.pointerEvents = 'none';
            flash.style.zIndex = '4';
            flash.style.animation = 'flash-effect 0.5s ease-out forwards';

            gameAreaEl.appendChild(flash);

            // åŠ¨ç”»ç»“æŸåç§»é™¤
            setTimeout(() => {
                flash.remove();
            }, 500);
        }

        // æ£€æŸ¥æ¸¸æˆæ˜¯å¦å®Œæˆ
        function checkGameComplete() {
            const remainingEnemies = enemies.filter(enemy => !enemy.hit);

            if (remainingEnemies.length === 0) {
                // æ¸¸æˆå®Œæˆ
                stopTimer();
                showGameOverModal();
            } else {
                // è®¾ç½®ä¸‹ä¸€ä¸ªå•è¯
                currentIndex++;
                setCurrentWord();
            }
        }

        // æ˜¾ç¤ºæ¸¸æˆç»“æŸæ¨¡æ€æ¡†
        function showGameOverModal() {
            finalTimeEl.textContent = timer;
            finalScoreEl.textContent = score;
            gameOverModalEl.style.display = 'block';
        }

        // ç»§ç»­æŒ‘æˆ˜
        function continueChallenge() {
            gameOverModalEl.style.display = 'none';
            currentIndex += currentPairs;

            // å¦‚æœç´¢å¼•è¶…å‡ºèŒƒå›´ï¼Œé‡æ–°å¼€å§‹
            if (currentIndex >= wordList.length) {
                currentIndex = 0;
                wordList = shuffleArray(wordList);
            }

            resetGame();
            gameStarted = true;
            startTimer();
            initGame();
        }

        // å½“DOMåŠ è½½å®Œæˆååˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>